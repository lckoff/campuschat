<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Campus Chat • Lycée</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="style.css" />
<script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script defer src="supabaseClient.js"></script>
<script defer src="script.js?v=8"></script>
</head>
<body>
<header class="navbar">
<div class="brand">Campus<span>Chat</span></div>
<nav>
<!-- si déconnecté -->
<div id="nav-auth">
<button id="btn-login" class="ghost">Se connecter</button>
<button id="btn-signup" class="primary">Créer un compte</button>
</div>
<!-- si connecté -->
<div id="nav-inapp" class="hidden">
<button id="btn-directory" class="ghost">Annuaire</button>
<button id="btn-logout" class="ghost">Se déconnecter</button>
</div>
</nav>
</header>

<!-- écran d’accueil (masqué dès qu’on est connecté) -->
<section class="hero">
<h1>Relie tout le lycée, simplement.</h1>
<p>Chat général sans pub. Données hébergées en UE.</p>
<div class="cta">
<button id="hero-signup" class="primary large">Commencer</button>
<button id="hero-login" class="ghost large">J’ai déjà un compte</button>
</div>
</section>

<!-- App -->
<section id="app" class="app hidden">
<aside class="sidebar">
<div class="me">
<div class="avatar"></div>
<div>
<div id="me-name" class="name">–</div>
<div id="me-class" class="class">–</div>
</div>
</div>
<div class="rooms">
<div class="room active"># général</div>
</div>
</aside>

<section class="chat">
<header class="chat-header">
<h2># général</h2>
</header>
<ul id="messages" class="messages"></ul>
<form id="composer" class="composer" autocomplete="off">
<input id="msg-input" type="text" placeholder="Écrire un message…" maxlength="800" />
<button type="submit" class="primary">Envoyer</button>
</form>
</section>
</section>

<!-- MODAL: inscription -->
<dialog id="modal-signup">
<form method="dialog" class="modal-card" id="signup-form">
<h3>Créer un compte</h3>
<div class="tos">
<p>Nous stockons <b>prénom, nom, e-mail, classe</b> pour vérifier l’appartenance au lycée et faire fonctionner le chat. Données hébergées en UE, jamais revendues.</p>
<label class="checkbox"><input id="chk-consent" type="checkbox" required /> J’accepte ces conditions</label>
</div>
<div class="grid">
<label>Prénom<input id="su-first" required></label>
<label>Nom<input id="su-last" required></label>
<label>Classe<input id="su-class" placeholder="ex. 1ère B" required></label>
<label>E-mail<input id="su-email" type="email" autocomplete="email" required></label>
<label>Mot de passe
<div class="pwd-wrap">
<input id="su-password" type="password" minlength="8" required>
<button type="button" id="su-toggle" class="icon-eye">👁</button>
</div>
</label>
</div>
<menu>
<button type="button" class="ghost close-modal">Annuler</button>
<button id="su-submit" class="primary">Créer mon compte</button>
</menu>
<div id="su-msg" class="form-msg"></div>
</form>
</dialog>

<!-- MODAL: connexion -->
<dialog id="modal-login">
<form method="dialog" class="modal-card" id="login-form">
<h3>Se connecter</h3>
<label>E-mail<input id="li-email" type="email" autocomplete="email" required></label>
<label>Mot de passe
<div class="pwd-wrap">
<input id="li-password" type="password" required>
<button type="button" id="li-toggle" class="icon-eye">👁</button>
</div>
</label>
<menu>
<button type="button" class="ghost close-modal">Annuler</button>
<button id="li-submit" class="primary">Connexion</button>
</menu>
<div id="li-msg" class="form-msg"></div>
</form>
</dialog>

<!-- MODAL: annuaire -->
<dialog id="modal-directory">
<div class="modal-card directory-card">
<div class="dir-header">
<h3>Annuaire</h3>
<input id="dir-q" type="search" placeholder="Rechercher prénom, nom ou classe…" />
</div>
<ul id="dir-list" class="dir-list"></ul>
<menu>
<button type="button" class="ghost close-modal">Fermer</button>
</menu>
</div>
</dialog>

<!-- MODAL: fiche profil (lecture seule) -->
<dialog id="modal-profile">
<div class="modal-card">
<h3>Profil</h3>
<div id="pf-name" class="prof-name">–</div>
<div id="pf-class" class="prof-class">–</div>
<menu>
<button type="button" class="primary" onclick="document.getElementById('modal-profile').close()">Fermer</button>
</menu>
</div>
</dialog>
</body>
</html>
